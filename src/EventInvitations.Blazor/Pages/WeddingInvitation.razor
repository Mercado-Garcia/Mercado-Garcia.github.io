
@using PersonalPortfolio.Library.Domain
@inject Library.Infrastructure.IWebsiteRepo WebsiteRepo
@inject IJSRuntime JS

<MudPaper Elevation="0">
    <div class="hero" style="@HeroStyle">
        <canvas id="snow-canvas"></canvas>
        <MudContainer Class="hero-content" MaxWidth="MaxWidth.False">
            <MudText Typo="Typo.h1" Class="couple">@(_wedding?.CoupleNames)</MudText>
            <MudText Typo="Typo.subtitle1" Class="date">@(_wedding?.DateText)</MudText>
            <MudText Typo="Typo.subtitle2" Class="subtitle">@(_wedding?.Subtitle)</MudText>
        </MudContainer>
        <MudText Class="scroll-indicator">@(_wedding?.ScrollIndicatorText)</MudText>
    </div>
</MudPaper>

@foreach (var sec in _wedding?.Sections ?? new List<WeddingSection>())
{
    <MudPaper Class="@(sec.AltStyle ? "fade-section alt" : "fade-section")" Elevation="0">
        <MudContainer Class="@(sec.Reverse ? "section-inner reverse" : "section-inner")" MaxWidth="MaxWidth.False">
            @if (sec.Reverse)
            {
                <div class="section-text">
                    <MudText Typo="Typo.h4">@sec.Title</MudText>
                    @foreach (var p in sec.Paragraphs ?? new List<string>())
                    {
                        <MudText Typo="Typo.body1">@p</MudText>
                    }
                </div>
                <MudImage Src="@sec.Image" Alt="@sec.ImageAlt" Class="section-image" />
            }
            else
            {
                <MudImage Src="@sec.Image" Alt="@sec.ImageAlt" Class="section-image" />
                <div class="section-text">
                    <MudText Typo="Typo.h4">@sec.Title</MudText>
                    @foreach (var p in sec.Paragraphs ?? new List<string>())
                    {
                        <MudText Typo="Typo.body1">@p</MudText>
                    }
                </div>
            }
        </MudContainer>
    </MudPaper>
}

<MudPaper Class="footer" Elevation="0">
    <MudText Align="Align.Center">@(_wedding?.FooterText)</MudText>
</MudPaper>

@code {
    private PersonalPortfolio.Library.Domain.WeddingInvitation _wedding;
    private string HeroStyle => string.IsNullOrWhiteSpace(_wedding?.HeroBackgroundImage) ? string.Empty : $"background-image:url('{_wedding.HeroBackgroundImage}');";

    protected override async Task OnInitializedAsync()
    {
        var siteData = await WebsiteRepo.GetWebsiteData();
        _wedding = siteData.WeddingInvitation;
    }

    protected override async Task OnAfterRenderAsync(bool firstRender)
    {
        if (firstRender)
        {
            await JS.InvokeVoidAsync("weddingSnow.init");
            await JS.InvokeVoidAsync("scrollFade.init");
        }
    }
}